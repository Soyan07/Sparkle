@model Sparkle.Api.Controllers.CheckoutController.AddressStepViewModel
@{
    ViewData["Title"] = "Shipping Address - Checkout";
    var langCookie = Context.Request.Cookies["sparkle-lang"] == "bn" ? "bn" : "en";
    var isBangla = langCookie == "bn";
}

<style>
    .checkout-page { padding: 2rem 0; background: #f8f9fa; min-height: calc(100vh - 400px); }
    .checkout-steps { display: flex; justify-content: center; margin-bottom: 2rem; }
    .step { flex: 1; max-width: 200px; text-align: center; position: relative; }
    .step-circle { width: 40px; height: 40px; border-radius: 50%; background: #ddd; color: #666; display: flex; align-items: center; justify-content: center; margin: 0 auto 0.5rem; font-weight: 700; }
    .step.active .step-circle { background: #ff6a00; color: white; }
    .step.completed .step-circle { background: #28a745; color: white; }
    .step-label { font-size: 0.9rem; color: #666; }
    .step.active .step-label { color: #ff6a00; font-weight: 600; }
    .address-card { background: white; padding: 1.5rem; border-radius: 8px; border: 2px solid #ddd; cursor: pointer; margin-bottom: 1rem; }
    .address-card:hover { border-color: #ff6a00; }
    .address-card.selected { border-color: #ff6a00; background: #fff5f0; }
    .address-card-header { display: flex; justify-content: space-between; margin-bottom: 0.5rem; }
    .address-form { background: white; padding: 2rem; border-radius: 8px; }
    .form-control:focus { border-color: #ff6a00; box-shadow: 0 0 0 0.2rem rgba(255, 106, 0, 0.25); }
    .btn-continue { background: #ff6a00; color: white; padding: 0.75rem 2rem; border: none; border-radius: 8px; font-weight: 600; transition: all 0.2s; }
    .btn-continue:hover { background: #e65f00; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(255,106,0,0.3); }
    .checkout-nav { display: flex; justify-content: space-between; gap: 1rem; margin-top: 1.5rem; }
    .btn-back { background: white; color: #666; padding: 0.75rem 2rem; border: 2px solid #e0e0e0; border-radius: 8px; font-weight: 600; text-decoration: none; display: inline-flex; align-items: center; gap: 0.5rem; transition: all 0.2s; }
    .btn-back:hover { border-color: #ff6a00; color: #ff6a00; transform: translateX(-3px); }
</style>

<div class="checkout-page">
    <div class="container">
        <!-- Progress Steps -->
        <div class="checkout-steps">
            <div class="step active">
                <div class="step-circle">1</div>
                <div class="step-label">@(isBangla ? "শিপিং" : "Shipping")</div>
            </div>
            <div class="step">
                <div class="step-circle">2</div>
                <div class="step-label">@(isBangla ? "ডেলিভারি" : "Delivery")</div>
            </div>
            <div class="step">
                <div class="step-circle">3</div>
                <div class="step-label">@(isBangla ? "পেমেন্ট" : "Payment")</div>
            </div>
            <div class="step">
                <div class="step-circle">4</div>
                <div class="step-label">@(isBangla ? "রিভিউ" : "Review")</div>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-8">
                <h2 class="sparkle-section-title mb-4">@(isBangla ? "শিপিং ঠিকানা" : "Shipping Address")</h2>

                @if (Model.SavedAddresses.Any())
                {
                    <h5>@(isBangla ? "সংরক্ষিত ঠিকানা বাছাই করুন" : "Select Saved Address")</h5>
                    <form method="post" action="/checkout/address" id="savedAddressForm">
                        <input type="hidden" name="savedAddressId" id="savedAddressIdInput">
                        @foreach (var addr in Model.SavedAddresses)
                        {
                            <div class="address-card" onclick="selectAddress(@addr.Id)">
                                <div class="address-card-header">
                                    <strong>@addr.FullName</strong>
                                    <span class="badge bg-primary">@addr.Phone</span>
                                </div>
                                <div>
                                    @addr.Line1
                                    @if (!string.IsNullOrEmpty(addr.Line2))
                                    {
                                        <span>, @addr.Line2</span>
                                    }
                                </div>
                                <div>@addr.City, @addr.State @addr.PostalCode</div>
                                <div>@addr.Country</div>
                            </div>
                        }
                    </form>

                    <div class="my-4 text-center">
                        <hr>
                        <span class="px-3 bg-white position-relative" style="top: -1.5rem;">OR</span>
                    </div>
                }

                <h5>@(isBangla ? "নতুন ঠিকানা যোগ করুন" : "Add New Address")</h5>
                <div class="address-form">
                    <form method="post" action="/checkout/address">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Full Name *</label>
                                <input type="text" name="FullName" class="form-control" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Phone *</label>
                                <input type="tel" name="Phone" class="form-control" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Address Line 1 *</label>
                            <input type="text" name="Line1" class="form-control" placeholder="House/Flat number, Street name" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Address Line 2</label>
                            <input type="text" name="Line2" class="form-control" placeholder="Landmark (optional)">
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label class="form-label">City *</label>
                                <select name="City" class="form-select" required>
                                    <option value="">Select City</option>
                                    <option value="Dhaka">Dhaka</option>
                                    <option value="Chittagong">Chittagong</option>
                                    <option value="Sylhet">Sylhet</option>
                                    <option value="Khulna">Khulna</option>
                                    <option value="Rajshahi">Rajshahi</option>
                                    <option value="Barisal">Barisal</option>
                                    <option value="Rangpur">Rangpur</option>
                                    <option value="Mymensingh">Mymensingh</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">State/Division *</label>
                                <select name="State" class="form-select" required>
                                    <option value="">Select Division</option>
                                    <option value="Dhaka">Dhaka</option>
                                    <option value="Chittagong">Chittagong</option>
                                    <option value="Sylhet">Sylhet</option>
                                    <option value="Khulna">Khulna</option>
                                    <option value="Rajshahi">Rajshahi</option>
                                    <option value="Barisal">Barisal</option>
                                    <option value="Rangpur">Rangpur</option>
                                    <option value="Mymensingh">Mymensingh</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Postal Code *</label>
                                <input type="text" name="PostalCode" class="form-control" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Country *</label>
                            <input type="text" name="Country" class="form-control" value="Bangladesh" readonly>
                        </div>
                        <div class="checkout-nav">
                            <a href="/cart" class="btn-back"><i class="bi bi-arrow-left"></i> @(isBangla ? "কার্ট" : "Back to Cart")</a>
                            <button type="submit" class="btn-continue" style="flex: 1;">
                                @(isBangla ? "ডেলিভারি ধাপে যান" : "Continue to Delivery") <i class="bi bi-arrow-right"></i>
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Order Summary Sidebar -->
            <div class="col-lg-4">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">@(isBangla ? "অর্ডার সারাংশ" : "Order Summary")</h5>
                        <div class="d-flex justify-content-between mb-2">
                            <span>Items (@Model.Cart.Items.Count)</span>
                            <span>৳ @Model.Subtotal.ToString("N2")</span>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span>Shipping</span>
                            <span class="text-muted">Calculated next</span>
                        </div>
                        <hr>
                        <div class="d-flex justify-content-between">
                            <strong>Estimated Total</strong>
                            <strong class="text-primary">৳ @Model.Subtotal.ToString("N2")</strong>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function selectAddress(addressId) {
        document.getElementById('savedAddressIdInput').value = addressId;
        document.getElementById('savedAddressForm').submit();
    }
</script>
