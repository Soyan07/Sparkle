@model Sparkle.Api.Controllers.CheckoutController.ReviewStepViewModel
@{
    ViewData["Title"] = "Review Order - Checkout";
    var langCookie = Context.Request.Cookies["sparkle-lang"] == "bn" ? "bn" : "en";
    var isBangla = langCookie == "bn";
}

<style>
    .checkout-page { 
        padding: 2rem 0 4rem; 
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); 
        min-height: 100vh;
    }
    
    /* Progress Steps */
    .checkout-steps { 
        display: flex; 
        justify-content: center; 
        margin-bottom: 2.5rem; 
        position: relative;
    }
    .checkout-steps::before {
        content: '';
        position: absolute;
        top: 20px;
        left: 25%;
        right: 25%;
        height: 3px;
        background: linear-gradient(to right, #28a745 0%, #28a745 75%, #ddd 75%, #ddd 100%);
        z-index: 0;
    }
    .step { 
        flex: 1; 
        max-width: 200px; 
        text-align: center; 
        position: relative;
        z-index: 1;
    }
    .step-circle { 
        width: 50px; 
        height: 50px; 
        border-radius: 50%; 
        background: white;
        border: 3px solid #ddd;
        color: #666; 
        display: flex; 
        align-items: center; 
        justify-content: center; 
        margin: 0 auto 0.75rem; 
        font-weight: 700;
        font-size: 1.2rem;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        transition: all 0.3s;
    }
    .step.active .step-circle { 
        background: linear-gradient(135deg, #ff6a00, #ff8c42); 
        color: white; 
        border-color: #ff6a00;
        box-shadow: 0 4px 12px rgba(255,106,0,0.4);
        transform: scale(1.1);
    }
    .step.completed .step-circle { 
        background: linear-gradient(135deg, #28a745, #34d058); 
        color: white; 
        border-color: #28a745;
    }
    .step-label { 
        font-size: 0.9rem; 
        color: #666; 
        font-weight: 500;
    }
    .step.active .step-label { 
        color: #ff6a00; 
        font-weight: 700; 
    }
    
    /* Review Sections */
    .review-section { 
        background: white; 
        padding: 1.75rem; 
        border-radius: 12px; 
        margin-bottom: 1.25rem;
        box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        border: 1px solid #e9ecef;
        transition: all 0.3s;
        position: relative;
        overflow: hidden;
    }
    .review-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 4px;
        height: 100%;
        background: linear-gradient(135deg, #ff6a00, #ff8c42);
    }
    .review-section:hover {
        box-shadow: 0 4px 16px rgba(0,0,0,0.1);
        transform: translateY(-2px);
    }
    .review-section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
        padding-bottom: 0.75rem;
        border-bottom: 2px solid #f8f9fa;
    }
    .review-section-header h5 {
        margin: 0;
        font-size: 1.1rem;
        font-weight: 700;
        color: #1f2937;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    .review-section-header h5 i {
        color: #ff6a00;
        font-size: 1.3rem;
    }
    .edit-btn {
        color: #6c757d;
        text-decoration: none;
        font-size: 0.875rem;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        gap: 0.35rem;
        padding: 0.4rem 0.75rem;
        border-radius: 6px;
        border: 1px solid #dee2e6;
        transition: all 0.2s;
    }
    .edit-btn:hover {
        color: #ff6a00;
        border-color: #ff6a00;
        background: #fff5f0;
    }
    
    /* Address Section */
    .address-content {
        display: grid;
        gap: 0.75rem;
    }
    .address-recipient {
        display: flex;
        align-items: center;
        gap: 1rem;
        flex-wrap: wrap;
    }
    .address-name {
        font-size: 1.05rem;
        font-weight: 700;
        color: #1f2937;
    }
    .address-phone {
        background: #f8f9fa;
        color: #495057;
        padding: 0.35rem 0.75rem;
        border-radius: 6px;
        font-size: 0.9rem;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        gap: 0.4rem;
    }
    .address-details {
        color: #495057;
        line-height: 1.6;
        font-size: 0.95rem;
    }
    
    /* Delivery Section */
    .delivery-info {
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: linear-gradient(135deg, #fff5f0, #ffffff);
        padding: 1rem;
        border-radius: 8px;
        border: 1px solid #ffe5d9;
    }
    .delivery-method {
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }
    .delivery-icon {
        width: 45px;
        height: 45px;
        background: linear-gradient(135deg, #ff6a00, #ff8c42);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.3rem;
    }
    .delivery-details h6 {
        margin: 0;
        font-weight: 700;
        color: #1f2937;
        font-size: 1rem;
    }
    .delivery-details p {
        margin: 0.25rem 0 0;
        font-size: 0.85rem;
        color: #6c757d;
    }
    .delivery-price {
        font-size: 1.25rem;
        font-weight: 700;
        color: #ff6a00;
    }
    
    /* Payment Section */
    .payment-info {
        display: flex;
        align-items: center;
        gap: 1rem;
        background: linear-gradient(135deg, #f0f9ff, #ffffff);
        padding: 1rem;
        border-radius: 8px;
        border: 1px solid #dbeafe;
    }
    .payment-icon {
        width: 50px;
        height: 50px;
        background: linear-gradient(135deg, #3b82f6, #60a5fa);
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.4rem;
    }
    .payment-details h6 {
        margin: 0;
        font-weight: 700;
        color: #1f2937;
        font-size: 1rem;
    }
    .payment-details p {
        margin: 0.25rem 0 0;
        font-size: 0.85rem;
        color: #6c757d;
    }
    
    /* Order Items */
    .order-item {
        display: flex;
        gap: 1rem;
        padding: 1rem;
        background: #f8f9fa;
        border-radius: 10px;
        margin-bottom: 0.75rem;
        transition: all 0.2s;
    }
    .order-item:hover {
        background: #e9ecef;
        transform: translateX(4px);
    }
    .item-image {
        width: 70px;
        height: 70px;
        background: white;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        color: #ff6a00;
        border: 2px solid #ffe5d9;
        flex-shrink: 0;
    }
    .item-details {
        flex: 1;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }
    .item-title {
        font-weight: 700;
        color: #1f2937;
        margin-bottom: 0.35rem;
        font-size: 1rem;
    }
    .item-meta {
        color: #6c757d;
        font-size: 0.875rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    .item-quantity {
        background: white;
        padding: 0.2rem 0.6rem;
        border-radius: 4px;
        font-weight: 600;
        border: 1px solid #dee2e6;
    }
    .item-price {
        text-align: right;
        font-weight: 700;
        color: #1f2937;
        font-size: 1.1rem;
    }
    
    /* Summary Sidebar */
    .summary-card {
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 16px rgba(0,0,0,0.1);
        border: 1px solid #e9ecef;
        position: sticky;
        top: 20px;
    }
    .summary-header {
        background: linear-gradient(135deg, #1f2937, #374151);
        color: white;
        padding: 1.5rem;
        border-radius: 12px 12px 0 0;
    }
    .summary-header h5 {
        margin: 0;
        font-size: 1.25rem;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    .summary-body {
        padding: 1.5rem;
    }
    .summary-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.75rem 0;
        border-bottom: 1px solid #f1f3f5;
    }
    .summary-row:last-child {
        border-bottom: none;
    }
    .summary-label {
        color: #6c757d;
        font-size: 0.95rem;
        font-weight: 500;
    }
    .summary-value {
        color: #1f2937;
        font-weight: 700;
        font-size: 1rem;
    }
    .summary-total {
        background: linear-gradient(135deg, #fff5f0, #ffffff);
        padding: 1.25rem;
        border-radius: 8px;
        margin: 1rem 0 1.5rem;
        border: 2px solid #ffe5d9;
    }
    .summary-total .summary-label {
        font-size: 1.1rem;
        font-weight: 700;
        color: #1f2937;
    }
    .summary-total .summary-value {
        font-size: 1.75rem;
        color: #ff6a00;
    }
    
    /* Trust Badges */
    .trust-badges {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 0.75rem;
        padding: 1rem;
        background: #f8f9fa;
        border-radius: 8px;
        margin-top: 1rem;
    }
    .trust-badge {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.8rem;
        color: #495057;
    }
    .trust-badge i {
        color: #28a745;
        font-size: 1rem;
    }
    
    /* Place Order Button */
    .btn-place-order {
        background: linear-gradient(135deg, #ff6a00, #ff8c42);
        color: white;
        padding: 1.25rem 2rem;
        font-size: 1.15rem;
        font-weight: 700;
        border: none;
        border-radius: 10px;
        width: 100%;
        transition: all 0.3s;
        box-shadow: 0 4px 16px rgba(255,106,0,0.3);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.75rem;
    }
    .btn-place-order:hover {
        background: linear-gradient(135deg, #e65f00, #ff7a2f);
        transform: translateY(-3px);
        box-shadow: 0 6px 20px rgba(255,106,0,0.4);
    }
    .btn-place-order i {
        font-size: 1.3rem;
    }
    
    /* Navigation */
    .checkout-nav {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 1rem;
        margin-top: 2rem;
        padding: 1.5rem;
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    }
    .btn-back {
        background: white;
        color: #666;
        padding: 0.85rem 1.75rem;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        font-weight: 600;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        transition: all 0.2s;
    }
    .btn-back:hover {
        border-color: #ff6a00;
        color: #ff6a00;
        background: #fff5f0;
        transform: translateX(-5px);
    }
    
    /* Info Box */
    .info-box {
        background: linear-gradient(135deg, #e0f2fe, #ffffff);
        border: 1px solid #bae6fd;
        border-radius: 10px;
        padding: 1.25rem;
        margin-top: 1.5rem;
        display: flex;
        align-items: start;
        gap: 1rem;
    }
    .info-box-icon {
        width: 40px;
        height: 40px;
        background: linear-gradient(135deg, #0ea5e9, #38bdf8);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.2rem;
        flex-shrink: 0;
    }
    .info-box-content h6 {
        margin: 0 0 0.5rem;
        font-weight: 700;
        color: #1f2937;
        font-size: 1rem;
    }
    .info-box-content p {
        margin: 0;
        color: #6c757d;
        font-size: 0.875rem;
        line-height: 1.6;
    }
    
    @@media (max-width: 991px) {
        .summary-card {
            position: static;
            margin-top: 2rem;
        }
    }
</style>

<div class="checkout-page">
    <div class="container">
        <div class="checkout-steps">
            <div class="step completed"><div class="step-circle"><i class="bi bi-check"></i></div><div class="step-label">@(isBangla ? "শিপিং" : "Shipping")</div></div>
            <div class="step completed"><div class="step-circle"><i class="bi bi-check"></i></div><div class="step-label">@(isBangla ? "ডেলিভারি" : "Delivery")</div></div>
            <div class="step completed"><div class="step-circle"><i class="bi bi-check"></i></div><div class="step-label">@(isBangla ? "পেমেন্ট" : "Payment")</div></div>
            <div class="step active"><div class="step-circle">4</div><div class="step-label">@(isBangla ? "রিভিউ" : "Review")</div></div>
        </div>

        <div class="row">
            <div class="col-lg-8">
                <h2 class="sparkle-section-title mb-4" style="font-size: 2rem; font-weight: 800; color: #1f2937;">
                    <i class="bi bi-check2-circle" style="color: #ff6a00;"></i>
                    @(isBangla ? "আপনার অর্ডার রিভিউ করুন" : "Review Your Order")
                </h2>

                <!-- Shipping Address Section -->
                <div class="review-section">
                    <div class="review-section-header">
                        <h5><i class="bi bi-geo-alt-fill"></i> @(isBangla ? "শিপিং ঠিকানা" : "Shipping Address")</h5>
                        <a href="/checkout/address" class="edit-btn">
                            <i class="bi bi-pencil-fill"></i> @(isBangla ? "পরিবর্তন" : "Edit")
                        </a>
                    </div>
                    <div class="address-content">
                        <div class="address-recipient">
                            <span class="address-name">@Model.Address.FullName</span>
                            <span class="address-phone">
                                <i class="bi bi-telephone-fill"></i> @Model.Address.Phone
                            </span>
                        </div>
                        <div class="address-details">
                            <i class="bi bi-house-door-fill" style="color: #ff6a00;"></i>
                            @Model.Address.Line1 @if (!string.IsNullOrEmpty(Model.Address.Line2)) { <text>, @Model.Address.Line2</text> }
                            <br>
                            @Model.Address.City, @Model.Address.State @Model.Address.PostalCode
                            <br>
                            <strong>@Model.Address.Country</strong>
                        </div>
                    </div>
                </div>

                <!-- Delivery Method Section -->
                <div class="review-section">
                    <div class="review-section-header">
                        <h5><i class="bi bi-truck"></i> @(isBangla ? "ডেলিভারি পদ্ধতি" : "Delivery Method")</h5>
                        <a href="/checkout/delivery" class="edit-btn">
                            <i class="bi bi-pencil-fill"></i> @(isBangla ? "পরিবর্তন" : "Edit")
                        </a>
                    </div>
                    <div class="delivery-info">
                        <div class="delivery-method">
                            <div class="delivery-icon">
                                <i class="bi bi-lightning-charge-fill"></i>
                            </div>
                            <div class="delivery-details">
                                <h6>@Model.DeliveryMethod</h6>
                                <p>@(isBangla ? "আপনার অর্ডার ৩-৫ কার্যদিবসে পৌঁছাবে" : "Your order will arrive in 3-5 business days")</p>
                            </div>
                        </div>
                        <div class="delivery-price">৳ @Model.ShippingFee.ToString("N2")</div>
                    </div>
                </div>

                <!-- Payment Method Section -->
                <div class="review-section">
                    <div class="review-section-header">
                        <h5><i class="bi bi-credit-card-2-front-fill"></i> @(isBangla ? "পেমেন্ট মেথড" : "Payment Method")</h5>
                        <a href="/checkout/payment" class="edit-btn">
                            <i class="bi bi-pencil-fill"></i> @(isBangla ? "পরিবর্তন" : "Edit")
                        </a>
                    </div>
                    <div class="payment-info">
                        <div class="payment-icon">
                            @if (Model.PaymentMethod.ToLower().Contains("cash"))
                            {
                                <i class="bi bi-cash-stack"></i>
                            }
                            else if (Model.PaymentMethod.ToLower().Contains("bkash") || Model.PaymentMethod.ToLower().Contains("nagad"))
                            {
                                <i class="bi bi-phone-fill"></i>
                            }
                            else
                            {
                                <i class="bi bi-credit-card-fill"></i>
                            }
                        </div>
                        <div class="payment-details">
                            <h6>@Model.PaymentMethod</h6>
                            <p>@(isBangla ? "নিরাপদ পেমেন্ট গ্যারান্টি" : "Secure payment guaranteed")</p>
                        </div>
                    </div>
                </div>

                <!-- Order Items Section -->
                <div class="review-section">
                    <div class="review-section-header">
                        <h5><i class="bi bi-bag-check-fill"></i> @(isBangla ? "অর্ডার আইটেম" : "Order Items") (@Model.Cart.Items.Count)</h5>
                        <a href="/cart" class="edit-btn">
                            <i class="bi bi-cart-fill"></i> @(isBangla ? "কার্টে যান" : "View Cart")
                        </a>
                    </div>
                    @foreach (var item in Model.Cart.Items)
                    {
                        var product = item.ProductVariant.Product;
                        <div class="order-item">
                            <div class="item-image">
                                <i class="bi bi-box-seam"></i>
                            </div>
                            <div class="item-details">
                                <div class="item-title">@product.Title</div>
                                <div class="item-meta">
                                    <span class="item-quantity">Qty: @item.Quantity</span>
                                    <span>×</span>
                                    <span>৳ @item.UnitPrice.ToString("N2")</span>
                                </div>
                            </div>
                            <div class="item-price">৳ @((item.Quantity * item.UnitPrice).ToString("N2"))</div>
                        </div>
                    }
                </div>

                <!-- Info Box -->
                <div class="info-box">
                    <div class="info-box-icon">
                        <i class="bi bi-shield-check"></i>
                    </div>
                    <div class="info-box-content">
                        <h6>@(isBangla ? "নিরাপদ চেকআউট" : "Safe & Secure Checkout")</h6>
                        <p>@(isBangla ? "আপনার ব্যক্তিগত তথ্য এনক্রিপ্ট করা এবং সুরক্ষিত। আমরা আপনার গোপনীয়তাকে গুরুত্ব দিই।" : "Your personal information is encrypted and secure. We value your privacy and protect your data.")</p>
                    </div>
                </div>
            </div>

            <!-- Summary Sidebar -->
            <div class="col-lg-4">
                <div class="summary-card">
                    <div class="summary-header">
                        <h5><i class="bi bi-receipt"></i> @(isBangla ? "অর্ডার সারাংশ" : "Order Summary")</h5>
                    </div>
                    <div class="summary-body">
                        <div class="summary-row">
                            <span class="summary-label">@(isBangla ? "সাবটোটাল" : "Subtotal") (@Model.Cart.Items.Count @(isBangla ? "আইটেম" : "items"))</span>
                            <span class="summary-value">৳ @Model.Subtotal.ToString("N2")</span>
                        </div>
                        <div class="summary-row">
                            <span class="summary-label">
                                <i class="bi bi-truck" style="color: #ff6a00;"></i> @(isBangla ? "শিপিং চার্জ" : "Shipping Fee")
                            </span>
                            <span class="summary-value">৳ @Model.ShippingFee.ToString("N2")</span>
                        </div>
                        <div class="summary-row">
                            <span class="summary-label">
                                <i class="bi bi-tag-fill" style="color: #28a745;"></i> @(isBangla ? "ডিসকাউন্ট" : "Discount")
                            </span>
                            <span class="summary-value" style="color: #28a745;">-৳0.00</span>
                        </div>
                        
                        <div class="summary-total">
                            <div class="summary-row">
                                <span class="summary-label">@(isBangla ? "সর্বমোট" : "Total Amount")</span>
                                <span class="summary-value">৳ @Model.Total.ToString("N2")</span>
                            </div>
                        </div>

                        <form method="post" action="/checkout/review">
                            <button type="submit" class="btn-place-order">
                                <i class="bi bi-check-circle-fill"></i>
                                <span>@(isBangla ? "অর্ডার কনফার্ম করুন" : "Place Order")</span>
                            </button>
                        </form>

                        <div class="trust-badges">
                            <div class="trust-badge">
                                <i class="bi bi-shield-fill-check"></i>
                                <span>@(isBangla ? "নিরাপদ পেমেন্ট" : "Secure Payment")</span>
                            </div>
                            <div class="trust-badge">
                                <i class="bi bi-truck"></i>
                                <span>@(isBangla ? "দ্রুত ডেলিভারি" : "Fast Delivery")</span>
                            </div>
                            <div class="trust-badge">
                                <i class="bi bi-arrow-return-left"></i>
                                <span>@(isBangla ? "সহজ রিটার্ন" : "Easy Returns")</span>
                            </div>
                            <div class="trust-badge">
                                <i class="bi bi-headset"></i>
                                <span>@(isBangla ? "24/7 সাপোর্ট" : "24/7 Support")</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Navigation -->
        <div class="checkout-nav">
            <a href="/checkout/payment" class="btn-back">
                <i class="bi bi-arrow-left"></i> @(isBangla ? "পেমেন্ট পেজে ফিরুন" : "Back to Payment")
            </a>
            <div style="color: #6c757d; font-size: 0.9rem;">
                <i class="bi bi-lock-fill" style="color: #28a745;"></i>
                @(isBangla ? "SSL এনক্রিপ্টেড" : "SSL Encrypted")
            </div>
        </div>
    </div>
</div>
